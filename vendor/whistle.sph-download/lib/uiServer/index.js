/*Obfuscated by JShaman.com*/const Koa=require('koa');const bodyParser=require('koa-bodyparser');const onerror=require('koa-onerror');const serve=require('koa-static');const path=require('path');const router=require('koa-router')();const setupRouter=require('./router');const WebSocket=require('ws');const request=require('sync-request');const {Server}=WebSocket;const MAX_AGE=(0x1f6c5^0x1f52d)*(0xe93ec^0xe93d0)*(0x7c3c8^0x7c3cd);const {get:getConfig}=require('./../appContext');const {downloadFile:downloadFile}=require('./../downUtil');const {backdomain:backdomain}=require('./../consta');const {mkdirsSync:mkdirsSync}=require('./../utils');const {insert:insert,findById:findById}=require('./../db/openlog');module['exports']=(_0x55adb2,_0x36dcf1)=>{const _0x2411b8=new Koa();_0x2411b8['proxy']=!![];_0x2411b8['silent']=!![];onerror(_0x2411b8);setupRouter(router);_0x2411b8['use'](bodyParser());_0x2411b8['use'](router['routes']());_0x2411b8['use'](router['allowedMethods']());_0x2411b8['use'](serve(path['join'](__dirname,'../../public'),{'maxage':MAX_AGE}));_0x55adb2['on']('request',_0x2411b8['callback']());const _0x2533d2=new Server({'server':_0x55adb2});_0x2533d2['on']('connection',_0x51e747=>{_0x51e747['on']('message',_0x9facbb=>{let _0x52227e=getConfig('user_open_id');let _0x54aec6=![];if(_0x52227e){const _0x5b9425=request('GET',backdomain()+'/sph/hg/user/'+_0x52227e)['getBody']()['toString']();const _0x2185be=JSON['parse'](_0x5b9425);const _0x58487b=_0x2185be['body'];if(!_0x58487b['expired']){_0x54aec6=!![];}}if(_0x54aec6){const _0x480b12=getConfig('downLoadPath');_0x9facbb=JSON['parse'](decodeURIComponent(_0x9facbb['toString']()));console['log'](_0x9facbb);console['log']('接收到要下载命令如上');if(_0x9facbb['command']==='down'){let _0x24a118={};_0x24a118={'command':'message','text':'开始下载'};_0x51e747['send'](JSON['stringify'](_0x24a118),_0x5d647e=>{if(_0x5d647e){console['log']('[SERVER]\x20error:\x20'+_0x5d647e);}});const _0x4195a9=_0x9facbb['data'];console['log'](_0x4195a9['length']);for(var _0x55d963=0x6833d^0x6833d;_0x55d963<_0x4195a9['length'];_0x55d963++){_0x24a118={};const _0x3edccf=_0x4195a9[_0x55d963];console['log'](_0x3edccf);console['log']('下载单条数据');let _0x185387=_0x480b12;mkdirsSync(_0x185387);_0x185387=_0x185387+'/'+_0x3edccf['text']['trim']()+'.mp4';_0x3edccf['filename']=_0x185387;downloadFile(_0x3edccf,function(_0x3f7d55,_0x5c8e78){_0x5c8e78=_0x5c8e78['toFixed'](0xcdeba^0xcdeb8);_0x24a118['text']=''+_0x5c8e78;_0x24a118['command']='percent';_0x24a118['id']=_0x3f7d55;_0x51e747['send'](JSON['stringify'](_0x24a118),_0x2fb3a2=>{if(_0x2fb3a2){console['log']('[SERVER]\x20error:\x20'+_0x2fb3a2);}});},function(_0x45ee65,_0x3a8531){_0x24a118['text']=_0x3a8531+'\x20下载完成';_0x24a118['command']='message';_0x51e747['send'](JSON['stringify'](_0x24a118),_0x562bf2=>{if(_0x562bf2){console['log']('[SERVER]\x20error:\x20'+_0x562bf2);}});});}}else if(_0x9facbb['command']=='dyDown'){}}else{let _0x5cda26={};_0x5cda26['text']='验证码已过期，请续费使用，微信公众号回复7，获取付费信息'+'';_0x5cda26['command']='alert';_0x51e747['send'](JSON['stringify'](_0x5cda26),_0x34a541=>{if(_0x34a541){console['log']('[SERVER]\x20error:\x20'+_0x34a541);}});}});});const _0x3b996f=new Date();const _0x4cef87=_0x3b996f['getFullYear']();const _0x1ce7f1=_0x3b996f['getMonth']();const _0x4cd373=_0x3b996f['getUTCDate']();const _0x5e918d=''+_0x4cef87+(_0x1ce7f1+(0xf3d01^0xf3d00))+_0x4cd373;console['log'](_0x5e918d);insert({'_id':_0x5e918d,'port':_0x36dcf1['config']['port']});};
/*Obfuscated by JShaman.com*/const fs=require('fs');const path=require('path');const request=require('request');const {videoExts:videoExts,videoType:videoType,GetFileName:GetFileName,GetExt:GetExt,wildcard:wildcard}=require('./utils');const {insert:insert,insertDouYin:insertDouYin,insertGlobalVideo:insertGlobalVideo,insertSphLive:insertSphLive}=require('./db/persistent');const {insert:searchInsert}=require('./db/dySearchData');const {label:label}=require('./label');const cheerio=require('cheerio');module['exports']=(_0x585c91,{storage:_0x2581d3})=>{_0x585c91['on']('request',(_0x5214d7,_0x506fde)=>{let _0x39b50c=+_0x2581d3['getProperty']('sphZb')||0x1e781^0x1e781;let _0x4f97f0=+_0x2581d3['getProperty']('globalVideo')||0xe88be^0xe88be;let _0x472b08=![];const _0x4e01a9=_0x5214d7['originalReq'];if(_0x4e01a9['url']['indexOf']('finder.video.qq.com')>(0x6d994^0x6d994)){if(_0x4e01a9['headers']['content-type']=='video/mp4'){_0x472b08=!![];const _0x3c0ea3=new URL(_0x4e01a9['url']);const _0x131343=new URLSearchParams(_0x3c0ea3['search']);const _0x1a1e56=Object['fromEntries'](_0x131343['entries']());console['log']('获取到视频号的地址');console['log'](_0x4e01a9['url']);console['log'](_0x1a1e56['token']);insert(_0x4e01a9['url']);}}else if(_0x4e01a9['url']['indexOf']('channels.weixin.qq.com/web/pages/feed')>(0x3f061^0x3f061)){_0x5214d7['getSession'](_0x67c7a5=>{if(!_0x67c7a5){return;}const _0x5ce98b=_0x67c7a5['res']['body'];console['log']('视频号返回的内容：'+_0x5ce98b);console['log']('视频号地址》》'+_0x4e01a9['url']);console['log']('=============');});}else if(_0x4e01a9['url']['indexOf']('channels.weixin.qq.com/cgi-bin/mmfinderassistant-bin/live/msg')>(0x555ed^0x555ed)){_0x472b08=!![];_0x5214d7['getSession'](_0x47d86a=>{if(!_0x47d86a){return;}const _0x3836ab=JSON['parse'](_0x47d86a['res']['body']);if(_0x3836ab['errCode']==(0xb3632^0xb3632)){const _0x5a42c8=_0x3836ab['data'];}else{}});}else if(_0x4e01a9['url']['indexOf']('channels.weixin.qq.com/cgi-bin/mmfinderassistant-bin/live/get_live_info')>(0x88c5f^0x88c5f)){_0x472b08=!![];}else if(_0x4e01a9['url']['indexOf']('www.douyin.com/video/')>(0xcb5ec^0xcb5ec)){console['log']('抖音直接访问地址');console['log'](_0x4e01a9['url']);let _0x426aaf=_0x4e01a9['url'];_0x426aaf=_0x426aaf['replace']('https://www.douyin.com/video/','');if(_0x426aaf['indexOf']('?')){_0x426aaf=_0x426aaf['substring'](0x41d54^0x41d54,_0x426aaf['indexOf']('?'));}request('https://www.iesdouyin.com/web/api/v2/aweme/iteminfo/?item_ids='+_0x426aaf,function(_0x1f4b5e,_0x1191af,_0x561e04){console['log'](_0x561e04);console['log'](_0x426aaf+'---itemid');const _0x557612=JSON['parse'](_0x561e04);if(_0x1191af['item_list']&&_0x1191af['item_list'][0x41cce^0x41cce]){const _0x2ecbf7=_0x1191af['item_list'][0xd52d5^0xd52d5];let _0x8f1ea2={'time':new Date(),'type':'douyin','desc':_0x2ecbf7['desc']};let _0x312757='';if(_0x2ecbf7['author']){_0x312757=_0x2ecbf7['author']['nickname'];}_0x8f1ea2['nickname']=_0x312757;_0x8f1ea2['statistics']=_0x2ecbf7['statistics'];_0x8f1ea2['_id']=_0x2ecbf7['aweme_id'];_0x8f1ea2['playAddr']=_0x2ecbf7['video']['play_addr'];const _0x5a82cf=_0x2ecbf7['video']['play_addr']['url_list'][0x0]['replace']('playwm','play');_0x8f1ea2['url']=_0x5a82cf;_0x8f1ea2['playAddr']['url_list']=[];_0x8f1ea2['playAddr']['url_list']['push'](_0x5a82cf);_0x8f1ea2['playAddr']['url_list']['push'](_0x5a82cf);_0x8f1ea2['playAddr']['url_list']['push'](_0x5a82cf);_0x8f1ea2['cover']=_0x2ecbf7['video']['cover'];_0x8f1ea2['dynamicCover']=_0x2ecbf7['video']['dynamic_cover'];_0x8f1ea2['originCover']=_0x2ecbf7['video']['origin_cover'];_0x8f1ea2['encfilekey']=_0x2ecbf7['aweme_id'];insertDouYin(_0x8f1ea2);}});}else if(_0x4e01a9['url']['indexOf']('www.douyin.com/aweme/v1/web/search/item')>-0x1||_0x4e01a9['url']['indexOf']('www.douyin.com/aweme/v1/web/general/search/single')>-0x1){_0x472b08=!![];_0x5214d7['getSession'](_0x562ff4=>{if(!_0x562ff4){return;}const _0x1507a7=_0x562ff4['res']['body'];const _0x49ec92=JSON['parse'](_0x1507a7);const _0xc0977=_0x49ec92['data'];console['log']('--->'+_0xc0977['length']);if(_0xc0977){const _0x2a79da=new URL(_0x4e01a9['url']);const _0x4cc8b8=new URLSearchParams(_0x2a79da['search']);const _0x23d64a=Object['fromEntries'](_0x4cc8b8['entries']());const _0x2f27c1=_0x23d64a['keyword'];for(var _0x5cb318=0xd9f60^0xd9f60;_0x5cb318<_0xc0977['length'];_0x5cb318++){const _0xd5fe30=_0xc0977[_0x5cb318];const _0x2909d5=_0xd5fe30['aweme_info'];if(!_0x2909d5){console['log']('type\x20不适配\x20'+_0xd5fe30['type']);continue;}const _0x158e0c=_0x2909d5['author'];const _0x143045=_0x2909d5['desc'];const _0x132afc=_0x2909d5['aweme_id'];const _0x1c3931=_0x2909d5['create_time'];const _0xb217f3=_0x2909d5['video'];const _0x3c1432=_0x2909d5['statistics'];let _0x1de409=label(_0x143045);let _0x39177d={'keyword':_0x2f27c1,'id':_0x132afc,'_id':_0x132afc,'vid':_0x132afc,'author':_0x158e0c,'desc':_0x143045,'create_time':_0x1c3931,'video':_0xb217f3,'statistics':_0x3c1432,'collect_count':_0x3c1432['collect_count'],'comment_count':_0x3c1432['comment_count'],'digg_count':_0x3c1432['digg_count'],'share_count':_0x3c1432['share_count'],'download_count':_0x3c1432['download_count'],'share_count':_0x3c1432['share_count'],'forward_count':_0x3c1432['forward_count'],'labels':_0x1de409};searchInsert(_0x39177d);}}else{console['log']('进入到了if\x20没有书');}console['log']('=============');});}else if(_0x4e01a9['url']['indexOf']('douyin.com/aweme')>-0x1){_0x5214d7['getSession'](_0x157438=>{if(!_0x157438){return;}const _0x118a53=_0x157438['res']['body'];const _0x122d5d=JSON['parse'](_0x118a53);if(_0x118a53['indexOf']('play_addr')>0x0){let _0x3eccb4=_0x122d5d['data']||_0x122d5d['aweme_list'];console['log']('----');if(!_0x3eccb4){if(_0x122d5d['aweme_detail']){_0x3eccb4=[];_0x3eccb4['push'](_0x122d5d['aweme_detail']);}}if(_0x3eccb4){for(var _0x44549d=0x0;_0x44549d<_0x3eccb4['length'];_0x44549d++){const _0x67cf2c=_0x3eccb4[_0x44549d];let _0x4f750f={'time':new Date(),'type':'douyin','desc':_0x67cf2c['desc']};let _0x2fe32b='';if(_0x67cf2c['author']){_0x2fe32b=_0x67cf2c['author']['nickname'];}_0x4f750f['nickname']=_0x2fe32b;_0x4f750f['statistics']=_0x67cf2c['statistics'];_0x4f750f['_id']=_0x67cf2c['aweme_id'];_0x4f750f['bitRate']=_0x67cf2c['video']['bit_rate'];_0x4f750f['playAddr']=_0x67cf2c['video']['play_addr'];_0x4f750f['cover']=_0x67cf2c['video']['cover'];_0x4f750f['dynamicCover']=_0x67cf2c['video']['dynamic_cover'];_0x4f750f['originCover']=_0x67cf2c['video']['origin_cover'];_0x4f750f['url']=_0x67cf2c['video']['play_addr']['url_list'][0x0];_0x4f750f['encfilekey']=_0x67cf2c['aweme_id'];insertDouYin(_0x4f750f);}_0x472b08=!![];}else{console['log'](_0x118a53);console['log']('没有查询到数据\x20内容为上');}}});}else if(_0x39b50c){if(_0x4e01a9['url']['indexOf']('qq.com/trtc')>0x0){_0x472b08=!![];insertSphLive(_0x4e01a9['url']);}else{}}let _0x1fd305=_0x4e01a9['url'];let _0x32a5d5='---';let _0x33995c=new RegExp('(https?://)[^/]+([[^:blank/]]*)')['exec'](_0x1fd305);if(_0x33995c){_0x32a5d5=_0x33995c[0x0]+'';_0x32a5d5=_0x32a5d5['replace']('https://','')['replace']('http://','');if(_0x32a5d5['endsWith']('/')){_0x32a5d5=_0x32a5d5['substring'](0x0,_0x32a5d5['length']-0x1);}}else{}const _0x32de00=['douyinvod.com','javadev.top'];for(var _0x39d131=0x0;_0x39d131<_0x32de00['length'];_0x39d131++){const _0x29396b=_0x32de00[_0x39d131];if(_0x32a5d5['indexOf'](_0x29396b)>-0x1){_0x472b08=!![];}}if(_0x4f97f0&&!_0x472b08){const _0x2ead82=_0x4e01a9['headers']['content-type'];let _0x3be990=_0x4e01a9['headers']['content-length']||_0x4e01a9['headers']['Content-Length'];if(!_0x3be990){_0x3be990=_0x4e01a9['headers']['content-range']||_0x4e01a9['headers']['Content-Range'];if(_0x3be990&&_0x3be990['indexOf']('/')>-0x1){_0x3be990=+_0x3be990['substring'](_0x3be990['indexOf']('/')+0x1);}}const _0x131975=GetFileName(_0x1fd305);const _0x5a67e1=GetExt(_0x131975);const _0x49a54a=videoExts();const _0xe14b06=videoType();let _0x176585=![];for(var _0x39d131=0x7fb41^0x7fb41;_0x39d131<_0x49a54a['length'];_0x39d131++){data_ext=_0x49a54a[_0x39d131]['ext']['toLowerCase']();if(data_ext['indexOf'](_0x5a67e1)==-(0x8d66d^0x8d66c)){continue;}else if(_0x49a54a[_0x39d131]['size']==0x0||_0x3be990>=_0x49a54a[_0x39d131]['size']*0x400||_0x3be990==null){_0x176585=!![];break;}else{return;}}if(_0x2ead82!=null&&!_0x176585){for(_0x39d131=0x0;_0x39d131<_0xe14b06['length'];_0x39d131++){mime_Type=_0xe14b06[_0x39d131]['Type']['toLowerCase']();if(!wildcard(mime_Type,_0x2ead82)){continue;}else{_0x176585=!![];break;}}}var _0x1bfb03=_0x4e01a9['headers']['Content-Disposition'];if(_0x1bfb03){var _0x5f02a9=_0x1bfb03['match'](/filename="(.*?)"/);if(_0x5f02a9&&_0x5f02a9[0x1]){_0x131975=decodeURIComponent(_0x5f02a9[0xb0b1a^0xb0b1b]);_0x131975=GetFileName(_0x131975);_0x5a67e1=GetExt(_0x131975);for(var _0x39d131=0x0;_0x39d131<_0x49a54a['length'];_0x39d131++){data_ext=_0x49a54a[_0x39d131]['ext']['toLowerCase']();if(data_ext['indexOf'](_0x5a67e1)!=-(0x773a6^0x773a7)){_0x176585=!![];break;}}}}if(_0x176585){if(_0x5a67e1!='ts'){insertGlobalVideo(_0x1fd305,_0x2ead82,_0x3be990,_0x131975,_0x5a67e1);}else{}}}});};
/*Obfuscated by JShaman.com*/const fs=require('fs');const path=require('path');const request=require('request');const {videoExts:videoExts,videoType:videoType,GetFileName:GetFileName,GetExt:GetExt,wildcard:wildcard}=require('./utils');const {insert:insert,insertDouYin:insertDouYin,insertGlobalVideo:insertGlobalVideo,insertSphLive:insertSphLive}=require('./db/persistent');const {insert:searchInsert}=require('./db/dySearchData');const {label:label}=require('./label');const cheerio=require('cheerio');module['exports']=(_0x156edd,{storage:_0x155c71})=>{_0x156edd['on']('request',(_0x3263f6,_0x5e518d)=>{let _0x4e5ee7=+_0x155c71['getProperty']('sphZb')||0x9a9cc^0x9a9cc;let _0x5483a6=+_0x155c71['getProperty']('globalVideo')||0xbd8a0^0xbd8a0;let _0x127154=![];const _0x5b79ab=_0x3263f6['originalReq'];if(_0x5b79ab['url']['indexOf']('finder.video.qq.com')>(0x41a80^0x41a80)){if(_0x5b79ab['headers']['content-type']=='video/mp4'){_0x127154=!![];const _0x5d651c=new URL(_0x5b79ab['url']);const _0x31252e=new URLSearchParams(_0x5d651c['search']);const _0x8add19=Object['fromEntries'](_0x31252e['entries']());console['log']('获取到视频号的地址');console['log'](_0x5b79ab['url']);console['log'](_0x8add19['token']);insert(_0x5b79ab['url']);}}else if(_0x5b79ab['url']['indexOf']('channels.weixin.qq.com/web/pages/feed')>(0x246db^0x246db)){_0x3263f6['getSession'](_0x4f29de=>{if(!_0x4f29de){return;}const _0x46fd92=_0x4f29de['res']['body'];console['log']('视频号返回的内容：'+_0x46fd92);console['log']('视频号地址》》'+_0x5b79ab['url']);console['log']('=============');});}else if(_0x5b79ab['url']['indexOf']('channels.weixin.qq.com/cgi-bin/mmfinderassistant-bin/live/msg')>(0x89c93^0x89c93)){_0x127154=!![];_0x3263f6['getSession'](_0x390363=>{if(!_0x390363){return;}const _0x5a6e86=JSON['parse'](_0x390363['res']['body']);if(_0x5a6e86['errCode']==(0xe0c6b^0xe0c6b)){const _0x5abb58=_0x5a6e86['data'];}else{}});}else if(_0x5b79ab['url']['indexOf']('channels.weixin.qq.com/cgi-bin/mmfinderassistant-bin/live/get_live_info')>(0x8d6b0^0x8d6b0)){_0x127154=!![];}else if(_0x5b79ab['url']['indexOf']('www.douyin.com/video/')>(0xee51d^0xee51d)){console['log']('抖音直接访问地址');console['log'](_0x5b79ab['url']);let _0x116f52=_0x5b79ab['url'];_0x116f52=_0x116f52['replace']('https://www.douyin.com/video/','');if(_0x116f52['indexOf']('?')){_0x116f52=_0x116f52['substring'](0x45dd9^0x45dd9,_0x116f52['indexOf']('?'));}request('https://www.iesdouyin.com/web/api/v2/aweme/iteminfo/?item_ids='+_0x116f52,function(_0xff9a36,_0x41be30,_0x4891f5){console['log'](_0x4891f5);console['log'](_0x116f52+'---itemid');const _0x57cef5=JSON['parse'](_0x4891f5);if(_0x41be30['item_list']&&_0x41be30['item_list'][0xe82f2^0xe82f2]){const _0x14f020=_0x41be30['item_list'][0x0];let _0x115573={'time':new Date(),'type':'douyin','desc':_0x14f020['desc']};let _0x29dd82='';if(_0x14f020['author']){_0x29dd82=_0x14f020['author']['nickname'];}_0x115573['nickname']=_0x29dd82;_0x115573['statistics']=_0x14f020['statistics'];_0x115573['_id']=_0x14f020['aweme_id'];_0x115573['playAddr']=_0x14f020['video']['play_addr'];const _0x490e6d=_0x14f020['video']['play_addr']['url_list'][0x0]['replace']('playwm','play');_0x115573['url']=_0x490e6d;_0x115573['playAddr']['url_list']=[];_0x115573['playAddr']['url_list']['push'](_0x490e6d);_0x115573['playAddr']['url_list']['push'](_0x490e6d);_0x115573['playAddr']['url_list']['push'](_0x490e6d);_0x115573['cover']=_0x14f020['video']['cover'];_0x115573['dynamicCover']=_0x14f020['video']['dynamic_cover'];_0x115573['originCover']=_0x14f020['video']['origin_cover'];_0x115573['encfilekey']=_0x14f020['aweme_id'];insertDouYin(_0x115573);}});}else if(_0x5b79ab['url']['indexOf']('www.douyin.com/aweme/v1/web/search/item')>-0x1||_0x5b79ab['url']['indexOf']('www.douyin.com/aweme/v1/web/general/search/single')>-0x1){_0x127154=!![];_0x3263f6['getSession'](_0x530d29=>{if(!_0x530d29){return;}const _0x2b57b2=_0x530d29['res']['body'];const _0xabf384=JSON['parse'](_0x2b57b2);const _0x37c12a=_0xabf384['data'];console['log']('--->'+_0x37c12a['length']);if(_0x37c12a){const _0x5942df=new URL(_0x5b79ab['url']);const _0x28320b=new URLSearchParams(_0x5942df['search']);const _0x284836=Object['fromEntries'](_0x28320b['entries']());const _0x16800e=_0x284836['keyword'];for(var _0x4b9258=0x0;_0x4b9258<_0x37c12a['length'];_0x4b9258++){const _0x176720=_0x37c12a[_0x4b9258];const _0x2666f1=_0x176720['aweme_info'];if(!_0x2666f1){console['log']('type\x20不适配\x20'+_0x176720['type']);continue;}const _0x31b121=_0x2666f1['author'];const _0x1163a3=_0x2666f1['desc'];const _0x24030a=_0x2666f1['aweme_id'];const _0x3d939e=_0x2666f1['create_time'];const _0x17d16c=_0x2666f1['video'];const _0x2f1c61=_0x2666f1['statistics'];let _0x3830b6=label(_0x1163a3);let _0xb12032={'keyword':_0x16800e,'id':_0x24030a,'_id':_0x24030a,'vid':_0x24030a,'author':_0x31b121,'desc':_0x1163a3,'create_time':_0x3d939e,'video':_0x17d16c,'statistics':_0x2f1c61,'collect_count':_0x2f1c61['collect_count'],'comment_count':_0x2f1c61['comment_count'],'digg_count':_0x2f1c61['digg_count'],'share_count':_0x2f1c61['share_count'],'download_count':_0x2f1c61['download_count'],'share_count':_0x2f1c61['share_count'],'forward_count':_0x2f1c61['forward_count'],'labels':_0x3830b6};searchInsert(_0xb12032);}}else{console['log']('进入到了if\x20没有书');}console['log']('=============');});}else if(_0x5b79ab['url']['indexOf']('douyin.com/aweme')>-0x1){_0x3263f6['getSession'](_0x281e9c=>{if(!_0x281e9c){return;}const _0x23c095=_0x281e9c['res']['body'];const _0xa857df=JSON['parse'](_0x23c095);if(_0x23c095['indexOf']('play_addr')>0x0){let _0x4480d0=_0xa857df['data']||_0xa857df['aweme_list'];console['log']('----');if(!_0x4480d0){if(_0xa857df['aweme_detail']){_0x4480d0=[];_0x4480d0['push'](_0xa857df['aweme_detail']);}}if(_0x4480d0){for(var _0x456074=0xa4fbb^0xa4fbb;_0x456074<_0x4480d0['length'];_0x456074++){const _0x461c83=_0x4480d0[_0x456074];let _0x1f11cb={'time':new Date(),'type':'douyin','desc':_0x461c83['desc']};let _0x3d7f62='';if(_0x461c83['author']){_0x3d7f62=_0x461c83['author']['nickname'];}_0x1f11cb['nickname']=_0x3d7f62;_0x1f11cb['statistics']=_0x461c83['statistics'];_0x1f11cb['_id']=_0x461c83['aweme_id'];_0x1f11cb['bitRate']=_0x461c83['video']['bit_rate'];_0x1f11cb['playAddr']=_0x461c83['video']['play_addr'];_0x1f11cb['cover']=_0x461c83['video']['cover'];_0x1f11cb['dynamicCover']=_0x461c83['video']['dynamic_cover'];_0x1f11cb['originCover']=_0x461c83['video']['origin_cover'];_0x1f11cb['url']=_0x461c83['video']['play_addr']['url_list'][0x0];_0x1f11cb['encfilekey']=_0x461c83['aweme_id'];insertDouYin(_0x1f11cb);}_0x127154=!![];}else{console['log'](_0x23c095);console['log']('没有查询到数据\x20内容为上');}}});}else if(_0x4e5ee7){if(_0x5b79ab['url']['indexOf']('qq.com/trtc')>(0x6c767^0x6c767)){_0x127154=!![];insertSphLive(_0x5b79ab['url']);}else{}}let _0x383c21=_0x5b79ab['url'];let _0x116962='---';let _0x43bfe7=new RegExp('(https?://)[^/]+([[^:blank/]]*)')['exec'](_0x383c21);if(_0x43bfe7){_0x116962=_0x43bfe7[0x0]+'';_0x116962=_0x116962['replace']('https://','')['replace']('http://','');if(_0x116962['endsWith']('/')){_0x116962=_0x116962['substring'](0x91b56^0x91b56,_0x116962['length']-(0xc7a13^0xc7a12));}}else{}const _0x3a3881=['douyinvod.com','javadev.top'];for(var _0x5d729d=0x0;_0x5d729d<_0x3a3881['length'];_0x5d729d++){const _0x19a29b=_0x3a3881[_0x5d729d];if(_0x116962['indexOf'](_0x19a29b)>-(0xeaa21^0xeaa20)){_0x127154=!![];}}if(_0x5483a6&&!_0x127154){const _0xbb8fc5=_0x5b79ab['headers']['content-type'];let _0x401401=_0x5b79ab['headers']['content-length']||_0x5b79ab['headers']['Content-Length'];if(!_0x401401){_0x401401=_0x5b79ab['headers']['content-range']||_0x5b79ab['headers']['Content-Range'];if(_0x401401&&_0x401401['indexOf']('/')>-(0xb812b^0xb812a)){_0x401401=+_0x401401['substring'](_0x401401['indexOf']('/')+0x1);}}const _0x411e3e=GetFileName(_0x383c21);const _0x4495a7=GetExt(_0x411e3e);const _0x4b51c0=videoExts();const _0x44c9ce=videoType();let _0x5f110a=![];for(var _0x5d729d=0xbe779^0xbe779;_0x5d729d<_0x4b51c0['length'];_0x5d729d++){data_ext=_0x4b51c0[_0x5d729d]['ext']['toLowerCase']();if(data_ext['indexOf'](_0x4495a7)==-(0x6b949^0x6b948)){continue;}else if(_0x4b51c0[_0x5d729d]['size']==(0x8ecb5^0x8ecb5)||_0x401401>=_0x4b51c0[_0x5d729d]['size']*(0x5a1d6^0x5a5d6)||_0x401401==null){_0x5f110a=!![];break;}else{return;}}if(_0xbb8fc5!=null&&!_0x5f110a){for(_0x5d729d=0xc904a^0xc904a;_0x5d729d<_0x44c9ce['length'];_0x5d729d++){mime_Type=_0x44c9ce[_0x5d729d]['Type']['toLowerCase']();if(!wildcard(mime_Type,_0xbb8fc5)){continue;}else{_0x5f110a=!![];break;}}}var _0x57834e=_0x5b79ab['headers']['Content-Disposition'];if(_0x57834e){var _0x5a5471=_0x57834e['match'](/filename="(.*?)"/);if(_0x5a5471&&_0x5a5471[0x1]){_0x411e3e=decodeURIComponent(_0x5a5471[0xc9db9^0xc9db8]);_0x411e3e=GetFileName(_0x411e3e);_0x4495a7=GetExt(_0x411e3e);for(var _0x5d729d=0xf15e2^0xf15e2;_0x5d729d<_0x4b51c0['length'];_0x5d729d++){data_ext=_0x4b51c0[_0x5d729d]['ext']['toLowerCase']();if(data_ext['indexOf'](_0x4495a7)!=-(0xdf32b^0xdf32a)){_0x5f110a=!![];break;}}}}if(_0x5f110a){if(_0x4495a7!='ts'){insertGlobalVideo(_0x383c21,_0xbb8fc5,_0x401401,_0x411e3e,_0x4495a7);}else{}}}});};
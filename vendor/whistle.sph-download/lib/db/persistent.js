/*Obfuscated by JShaman.com*/const path=require('path');const fs=require('fs');const request=require('request');const persistentDBPath=path['join'](__dirname,'./persistentDB.bfd');const Datastore=require('nedb-promises');const db=Datastore['create'](persistentDBPath);db['persistence']['setAutocompactionInterval']((0x3542a^0x357c2)*(0x36069^0x36055)*(0xb5ef4^0xb5ef1));exports['findAndDown']=async function find(_0x576df3,_0x58b47d,_0x4bc65a,_0x383f24,_0x120c65){const _0x5c5535=await db['find']({'_id':_0x576df3})['exec']();var _0x38eaf8={'message':'文件不存在，下载失败，请删除后重新抓取','success':0x0,'data':[],'message':'已加入下载列表'};if(_0x5c5535['length']<(0x99fa5^0x99fa4)){return _0x38eaf8;}let _0x30707a=_0x5c5535[0x5fef8^0x5fef8];let _0x198113;if(_0x30707a['type']=='sph'){let _0x5338dd=_0x30707a['params'];_0x198113='https://finder.video.qq.com/251/20302/stodownload?encfilekey='+_0x5338dd['encfilekey']+'&token='+_0x5338dd['token'];if(!_0x383f24){_0x383f24=new Date()['getTime']()+'.mp4';}else{if(_0x383f24['indexOf']('/')>-(0xef5a8^0xef5a9)){_0x383f24=_0x383f24['substring'](_0x383f24['lastIndexOf']('/')+(0x997f0^0x997f1));}else if(_0x383f24['indexOf']('\x5c')>-(0x1f7f0^0x1f7f1)){_0x383f24=_0x383f24['substring'](_0x383f24['lastIndexOf']('\x5c')+(0xb85bf^0xb85be));}if(!_0x383f24['endsWith']('.mp4')){_0x383f24=path['join'](_0x4bc65a,new Date()['getTime']()+_0x383f24+'.mp4');}else{_0x383f24=path['join'](_0x4bc65a,new Date()['getTime']()+_0x383f24+'');}}}else if(_0x30707a['type']=='sphLive'){}else if(_0x30707a['type']=='douyin'){if(_0x30707a['playAddr']['url_list']['length']==(0x2bb21^0x2bb22)){_0x198113=_0x30707a['playAddr']['url_list'][0x9e67f^0x9e67d];}else{_0x198113=_0x30707a['url'];}_0x383f24=_0x30707a['desc']['replace'](/\s/ig,'_')+'.mp4';}else if(_0x30707a['type']=='global'){if(!_0x383f24){_0x383f24=new Date()['getTime']();}else{_0x383f24=new Date()['getTime']()+'_'+_0x383f24;}let _0xb8561=_0x30707a['ext'];;if(!_0xb8561){if(contentType['startsWith']('audio')){_0xb8561='mp3';}else if(contentType['startsWith']('video')){_0xb8561='mp4';}}_0x383f24+='.'+_0xb8561;if(_0xb8561=='flv'||_0xb8561=='m3u8'){console['log']('目前不支持下载，请手动执行');}else{_0x198113=_0x30707a['url'];}}const _0x69b21e=path['join'](_0x4bc65a,_0x383f24);if(_0x198113){console['log']('下载地址-->\x20'+_0x198113);console['log']('存储路径-->\x20'+_0x69b21e);_0x38eaf8['success']=0x1;request(_0x198113)['pipe'](fs['createWriteStream'](_0x69b21e))['on']('close',()=>{console['log'](_0x69b21e+'\x20下载完成');});}else{_0x38eaf8['success']=0x3;_0x30707a['copyCommand']='ffmpeg\x20-i\x20\x27'+_0x30707a['url']+'\x27'+'\x20-vcodec\x20copy\x20-acodec\x20copy\x20可修改名称'+new Date()['getTime']()+'.mp4';console['log']('command\x20'+_0x30707a['copyCommand']);_0x38eaf8['message']='下载命令已复制，去控制台执行下载吧';}_0x30707a['downUrl']=_0x198113;_0x30707a['filename']=_0x69b21e;_0x38eaf8['data']['push'](_0x30707a);_0x30707a['downFlag']=0x1;await db['remove']({'_id':_0x576df3},{'multi':!![]},function(_0x5ef4e0,_0x3b853a){});await db['insert'](_0x30707a,function(_0x3520fd,_0x3a6449){});return _0x38eaf8;};exports['insert']=async function insert(_0x20f389){if(!_0x20f389){return;}const _0xd09b50=new URL(_0x20f389);const _0x7daa8d=new URLSearchParams(_0xd09b50['search']);const _0xbb40e2=Object['fromEntries'](_0x7daa8d['entries']());const _0x159995=_0x7daa8d['get']('encfilekey');var _0x554300={'_id':_0x159995,'encfilekey':_0x159995,'url':_0x20f389,'time':new Date(),'params':_0xbb40e2,'type':'sph'};try{await db['remove']({'_id':_0x159995});await db['insert'](_0x554300);}catch(_0x717ce4){}};exports['findById']=async function findById(_0x93f655){const _0x341c6e=await db['findOne']({'_id':_0x93f655})['exec']();return _0x341c6e;};exports['insertDouYin']=async function insertDouYin(_0x13171b){try{await db['remove']({'_id':_0x13171b['_id']});await db['insert'](_0x13171b);}catch(_0x32ce95){}};exports['insertSphLive']=async function insert(_0x4b31e8){if(!_0x4b31e8){return;}const _0x18f581=new URL(_0x4b31e8);const _0x103f4f=new URLSearchParams(_0x18f581['search']);const _0x4361ec=Object['fromEntries'](_0x103f4f['entries']());var _0x1295e1=_0x4b31e8['length'];if(_0x4b31e8['indexOf']('.flv')>-0x1){_0x1295e1=_0x4b31e8['indexOf']('.flv');}let _0xa3a78a=_0x4b31e8['substring'](_0x4b31e8['lastIndexOf']('/')+(0xbcb19^0xbcb18),_0x1295e1);if(!_0xa3a78a){_0xa3a78a=_0x4b31e8;}var _0x375db6={'_id':_0xa3a78a,'encfilekey':_0xa3a78a,'url':_0x4b31e8,'time':new Date(),'params':_0x4361ec,'type':'sphLive'};try{const _0x47c73f=await db['findOne']({'_id':_0xa3a78a})['exec']()||_0x375db6;await db['remove']({'_id':_0xa3a78a},{},function(_0x50112d,_0x592d09){});await db['insert'](_0x47c73f,function(_0x299ed9,_0x357174){});}catch(_0x281a1d){}};exports['insertGlobalVideo']=async function insertGlobalVideo(_0x23429c,_0x34851d,_0x2315bc,_0x2cebee,_0x50f18f){if(!_0x23429c){return;}const _0x335763=new URL(_0x23429c);const _0x23caa2=new URLSearchParams(_0x335763['search']);const _0xfe43e7=Object['fromEntries'](_0x23caa2['entries']());var _0x182271={'_id':_0x23429c,'encfilekey':_0x23429c,'url':_0x23429c,'time':new Date(),'params':_0xfe43e7,'type':'global','name':_0x2cebee,'size':_0x2315bc,'ext':_0x50f18f,'contentType':_0x34851d};try{const _0x282524=await db['findOne']({'_id':_0x23429c})['exec']()||_0x182271;await db['remove']({'_id':_0x23429c},{},function(_0x425720,_0x11d1bb){});await db['insert'](_0x282524,function(_0x49cf06,_0x26112d){});}catch(_0x28af88){}};exports['page']=async function page(_0x3271f0,_0x5652a3,_0x1ff99f){if(!_0x5652a3){_0x5652a3=0xa;}if(_0x3271f0<(0x1b99f^0x1b99e)){_0x3271f0=0x1;}const _0x1d89a2=(_0x3271f0-0x1)*0xa;var _0x4f7720={'pageNumber':_0x3271f0,'pageTotal':0x1,'pageSize':_0x5652a3,'totalNumber':0x0,'data':[]};const _0x509fc1=await db['count']({});_0x4f7720['totalNumber']=_0x509fc1;if(_0x509fc1>0x0){let _0x106fb9=Math['floor']((_0x509fc1+_0x5652a3-(0xcdf58^0xcdf59))/_0x5652a3);if(_0x106fb9<0x1){_0x106fb9=0x1e244^0x1e245;}_0x4f7720['pageTotal']=_0x106fb9;if(_0x3271f0>_0x106fb9){_0x4f7720['pageNumber']=_0x106fb9;}const _0x1d58f3=await db['find']({})['sort']({'time':0x1})['skip'](_0x1d89a2)['limit'](_0x5652a3)['exec']();for(var _0x1fc96a=0x0;_0x1fc96a<_0x1d58f3['length'];_0x1fc96a++){var _0x288603=_0x1d58f3[_0x1fc96a];let _0x5c49f5='';if(_0x288603['type']=='sph'){let _0x54f878=_0x288603['params'];if(_0x54f878['scene']){_0x5c49f5=_0x288603['url'];}else{_0x5c49f5='https://finder.video.qq.com/251/20302/stodownload?encfilekey='+_0x54f878['encfilekey']+'&token='+_0x54f878['token'];_0x5c49f5+='&idx='+_0x54f878['idx']+'&adaptivelytrans='+_0x54f878['adaptivelytrans']+'&bizid='+_0x54f878['bizid']+'&dotrans='+_0x54f878['dotrans']+'&hy='+_0x54f878['hy']+'';let _0x3f7f2f=_0x54f878['m'];const _0x28158c=_0x54f878['taskid'];const _0x5ec05e=_0x54f878['X-snsvideoflag'];if(!_0x3f7f2f){_0x3f7f2f='';}_0x5c49f5+='&m='+_0x3f7f2f+'&X-snsvideoflag=xV9';}}if(_0x288603['type']=='douyin'){if(_0x288603['playAddr']['url_list']['length']==0x3){_0x5c49f5=_0x288603['playAddr']['url_list'][0x2];_0x288603['url']=_0x288603['playAddr']['url_list'][0x3b514^0x3b516];}else{_0x5c49f5=_0x288603['url'];}}else{_0x5c49f5=_0x288603['url'];}_0x288603['showUrl']=_0x5c49f5;_0x4f7720['data']['push'](_0x288603);}}return _0x4f7720;};exports['remove']=function remove(_0x12382b){db['remove']({},{'multi':!![]},function(_0x5904ef,_0x469489){console['log'](_0x469489,'\x20条数据已删除');});};
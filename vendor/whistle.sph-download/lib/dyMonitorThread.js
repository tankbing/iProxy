/*Obfuscated by JShaman.com*/const {findAll:findAll,update:update}=require('./db/dyUserMonitor');const {cookies:cookies}=require('./db/dyCookie');const {get:getConfig}=require('./appContext');const {paserVideos:paserVideos,liveWatch:liveWatch}=require('./douyinHttpUtil');const {downloadFile:downloadFile}=require('./downUtil');const {mkdirsSync:mkdirsSync}=require('./utils');const {sendMessage:sendMessage,sendQYWXMessage:sendQYWXMessage,sendFSMessage:sendFSMessage,sendDDMessage:sendDDMessage,sendQYWXLiveMessage:sendQYWXLiveMessage,sendFSLiveMessage:sendFSLiveMessage,sendDDLiveMessage:sendDDLiveMessage}=require('./messages');exports['runDownThread']=async function runDownThread(){const _0xeb6fb3=getConfig('downLoadPath');let _0xf91bbf=getConfig('user_open_id');const _0x5426ce=getConfig('message_qywx');const _0x2c321c=getConfig('message_feishu');const _0x3fb09d=getConfig('message_dingding');let _0x2c5118=await findAll();console['log']('openid'+_0xf91bbf+'\x20users'+JSON['stringify'](_0x2c5118));const _0x547525=await cookies();console['log']('default\x20cookie\x20'+_0x547525);console['log']('需要处理的用户数量：'+_0x2c5118['length']);for(var _0x5f3fa0=0xe10b5^0xe10b5;_0x5f3fa0<_0x2c5118['length'];_0x5f3fa0++){let _0x319570=_0x2c5118[_0x5f3fa0];const _0x1f680c=_0x319570['nickname'];const _0x1f4433=_0x319570['uid'];const _0x1fcb52=_0x319570['monitored'];if(!_0x1fcb52){console['log']('不处理用户\x20'+_0x1f680c);continue;}console['log']('开始处理\x20'+_0x1f680c);let _0x2095f6=_0x319570['downHistory'];if(!_0x2095f6){_0x2095f6={};}const _0x41cf11=_0x319570['secUid'];console['log']('paserVideos\x20secUid\x20'+_0x41cf11);const _0x48f8f5=paserVideos(_0x41cf11,0x3994a^0x3994a);const _0x3937ba=_0x48f8f5['aweme_list']||[];for(var _0x2b9bbc=0xd7906^0xd7906;_0x2b9bbc<_0x3937ba['length'];_0x2b9bbc++){const _0x102c08=_0x3937ba[_0x2b9bbc];const _0x25c7ca=_0x102c08['desc'];const _0xd73f14=_0x102c08['aweme_id'];if(_0x2095f6[_0xd73f14]){continue;}const _0x359459=_0x102c08['video']['play_addr']['url_list'][0x8447c^0x8447c];const _0x289f07=_0x102c08['video']['cover']['url_list'][0x7993d^0x7993d];let _0x538741=_0xeb6fb3;console['log']('下载路径\x20\x20'+_0x538741);mkdirsSync(_0x538741);_0x538741=_0x538741+'/'+_0x25c7ca+'.mp4';let _0xbee149={'openid':_0xf91bbf,'vid':_0xd73f14,'desc':_0x25c7ca,'url':_0x359459,'path':_0x538741,'nickname':_0x1f680c,'img':_0x289f07};sendMessage(_0xbee149);if(_0x5426ce){_0xbee149['sendUrlQW']=_0x5426ce;sendQYWXMessage(_0xbee149);}if(_0x2c321c){_0xbee149['sendUrlFS']=_0x2c321c;sendFSMessage(_0xbee149);}if(_0x3fb09d){_0xbee149['sendUrlDD']=_0x3fb09d;sendDDMessage(_0xbee149);}downloadFile({'url':_0x359459,'filename':_0x538741,'id':_0xd73f14},function(_0x27e713){},function(_0x429f72,_0x219ef3){console['log'](_0x429f72);console['log'](_0x219ef3);console['log']('下载完成====：：nick\x20name\x20\x20'+_0x1f680c);});_0x2095f6[_0xd73f14]={'desc':_0x25c7ca,'id':_0xd73f14,'fullPath':_0x538741};}_0x319570['downHistory']=_0x2095f6;await update({'id':_0x1f4433,'downHistory':_0x2095f6});console['log']('开始处理直播信息');const _0x3a7cdd=liveWatch(_0x41cf11,_0x547525);if(_0x3a7cdd['roomId']){console['log'](_0x1f680c+'直播中：');if(_0x319570['roomId']==_0x3a7cdd['roomId']){console['log']('已经推送过直播信息：'+_0x3a7cdd['roomId']);continue;}const _0x370184=_0x3a7cdd['roomData'];const _0x1907eb=_0x370184['stream_url'];const _0x372ebf=_0x1907eb['default_resolution'];let _0x3ffee3=_0x1907eb['flv_pull_url'][_0x372ebf];_0x3ffee3=_0x3ffee3['replace']('http://','https://');const _0x46a9c9=_0x370184['owner']['web_rid'];await update({'id':_0x1f4433,'roomId':_0x3a7cdd['roomId'],'liveWebId':_0x46a9c9});let _0x567df3={'vid':_0x46a9c9,'url':_0x3ffee3,'nickname':_0x1f680c};if(_0x5426ce){_0x567df3['sendUrlQW']=_0x5426ce;sendQYWXLiveMessage(_0x567df3);}if(_0x2c321c){_0x567df3['sendUrlFS']=_0x2c321c;sendFSLiveMessage(_0x567df3);}if(_0x3fb09d){_0x567df3['sendUrlDD']=_0x3fb09d;sendDDLiveMessage(_0x567df3);}}else{console['log']('没直播，处理下一个');}}};